# 清理序列化文件

## 问题描述
由于 Spring AI 版本更新，`FileBasedChatMemory` 使用的 Kryo 序列化文件可能不兼容，导致 `KryoException: Encountered unregistered class ID: 104` 错误。

## 解决方案

### 方案1：手动清理（推荐）
删除 `chat-memory` 目录下的所有 `.kryo` 文件：

```bash
# Windows
del /s /q chat-memory\*.kryo

# Linux/Mac
rm -f chat-memory/*.kryo
```

### 方案2：程序自动清理
我已经修改了 `FileBasedChatMemory` 类，当遇到序列化错误时会自动删除旧文件。

### 方案3：使用新的序列化方式
可以考虑使用 JSON 序列化替代 Kryo：

```java
// 使用 Jackson 进行 JSON 序列化
ObjectMapper mapper = new ObjectMapper();
mapper.writeValue(file, messages);
List<Message> messages = mapper.readValue(file, new TypeReference<List<Message>>() {});
```

## 修复内容

1. **注册了 Spring AI 相关类**：
   - `Media.class`
   - `UserMessage.class`
   - `AssistantMessage.class`
   - `SystemMessage.class`
   - `ArrayList.class`

2. **改进了错误处理**：
   - 读取失败时自动删除旧文件
   - 更好的错误日志记录

3. **保持向后兼容**：
   - 如果旧文件无法读取，会自动清理并重新开始

## 使用建议

1. 首次运行修复后的代码时，建议先清理旧的序列化文件
2. 如果仍有问题，可以考虑完全删除 `chat-memory` 目录
3. 长期来看，建议考虑使用更稳定的序列化方案（如 JSON）
